# å°ˆæ¡ˆ Bï¼šä»»å‹™ API ä¸­å¿ƒ + Web UI ç®¡ç†ç³»çµ±

æœ¬å°ˆæ¡ˆè² è²¬è™•ç†æ‰€æœ‰ä»»å‹™é‚è¼¯ï¼Œä¾›å¤–éƒ¨å¦‚ LINE Bot Proxy å‘¼å«ä»»å‹™ APIã€‚  
åŒæ™‚æä¾› Web ç®¡ç†ä»‹é¢ä¾›äººå·¥æ“ä½œèˆ‡è¨­å®šã€‚

---

## ğŸ§  åŠŸèƒ½ç¸½è¦½

- âœ… æä¾› `/api/execute_task` ä»»å‹™åŸ·è¡Œ API
- âœ… å¯é€é `tasks/task_x.py` æ¨¡çµ„æ“´å……ä»»å‹™
- âœ… æ”¯æ´ Firestore æ—¥èªŒç´€éŒ„èˆ‡éæœŸè‡ªå‹•æ¸…é™¤
- âœ… æä¾›å®Œæ•´ä»»å‹™ç®¡ç† Web UI

---

## ğŸ“ å°ˆæ¡ˆè³‡æ–™å¤¾çµæ§‹

```
å°ˆæ¡ˆè³‡æ–™å¤¾/
â”œâ”€â”€ app_ui.py                    # ä¸»ç¨‹å¼
â”œâ”€â”€ firestore_utils_lazy_env.py # Firestore å·¥å…·
â”œâ”€â”€ /tasks                       # ä»»å‹™æ¨¡çµ„ï¼ˆå¦‚ task_b.pyï¼‰
â”œâ”€â”€ /templates                   # ç®¡ç† UI é é¢
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ task_registry.html
â”‚   â”œâ”€â”€ add_keyword.html
â”‚   â”œâ”€â”€ edit_description.html
â”‚   â”œâ”€â”€ manage.html
â”‚   â””â”€â”€ task_table.html
â”œâ”€â”€ requirements.txt             # å¥—ä»¶éœ€æ±‚
```

---

## ğŸ” ç’°å¢ƒè®Šæ•¸è¨­å®š

| åç¨± | èªªæ˜ |
|------|------|
| `FIREBASE_KEY` | base64 ç·¨ç¢¼çš„ Firebase Admin SDK JSON é‡‘é‘° |

---

## ğŸ”§ ä¸»è¦ API è·¯ç”±

| è·¯å¾‘ | æ–¹æ³• | èªªæ˜ |
|------|------|------|
| `/api/execute_task` | POST | æ¥æ”¶ä»»å‹™åç¨±ä¸¦åŸ·è¡Œå°æ‡‰æ¨¡çµ„ï¼Œå¦‚ `tasks/task_b.py` |
| `/delete_expired_logs` | GET | æ‰‹å‹•æ¸…é™¤ Firestore ä¸­å·²éæœŸï¼ˆè¶…é 60 å¤©ï¼‰çš„ç´€éŒ„ |

---

## ğŸŒ ç®¡ç†é é¢è·¯ç”±

| è·¯å¾‘ | åŠŸèƒ½ |
|------|------|
| `/` | å°è¦½é¦–é  |
| `/task_registry` | æŸ¥è©¢æ‰€æœ‰ä»»å‹™èˆ‡é—œéµå­—èªªæ˜ |
| `/add_keyword` | æ–°å¢ä»»å‹™èˆ‡æ¨¡çµ„ |
| `/edit_description` | ç·¨è¼¯ä»»å‹™èªªæ˜ |
| `/manage` | åˆªé™¤ä»»å‹™ / åŒ¯å‡ºè¨˜éŒ„ |
| `/tasks` | ä¿è­·å…§éƒ¨è·¯ç”±ï¼Œç¦æ­¢å­˜å– |
| `/export_logs` | åŒ¯å‡º logs CSV |
| `/delete_expired_logs` | æ¸…é™¤ 60 å¤©å‰çš„ logs |

---

## ğŸ“¬ API å‘¼å«ç¯„ä¾‹ï¼ˆfor å°ˆæ¡ˆ Aï¼‰

```json
POST /api/execute_task
{
  "task": "ä»»å‹™B",
  "source_id": "U12345678",
  "source_type": "user",
  "original_text": "#ä»»å‹™B"
}
```

---

## ğŸ“ Firestore ç´€éŒ„æ ¼å¼

æ¯æ¬¡ä»»å‹™æˆåŠŸæˆ–å¤±æ•—éƒ½æœƒè¨˜éŒ„è‡³ `logs` é›†åˆï¼š

```json
{
  "timestamp": "2025-05-24 21:50:00",
  "task": "ä»»å‹™B",
  "source_id": "Uxxxx",
  "source_type": "user",
  "message": "#ä»»å‹™B",
  "result": "âœ… ä»»å‹™B åŸ·è¡ŒæˆåŠŸ",
  "expiry": "2025-07-23"
}
```

---

## ğŸ§± ä»»å‹™æ¨¡çµ„èªªæ˜

æ‰€æœ‰ä»»å‹™å°æ‡‰çš„æ¨¡çµ„æ”¾åœ¨ `tasks/` ç›®éŒ„ä¸‹ï¼Œå‘½åç‚º `task_x.py`  
æ¯å€‹æ¨¡çµ„éœ€åŒ…å«ä»¥ä¸‹å‡½å¼ï¼š

```python
def run(event):
    return "ä»»å‹™åŸ·è¡Œçµæœ"
```

---

## ğŸ”§ å¥—ä»¶éœ€æ±‚

- `flask`
- `firebase-admin`
- `gunicorn`

---

## âœ… å¯æ“´å……æ–¹å‘

- [ ] åŠ å…¥ç™»å…¥é©—è­‰ç³»çµ±
- [ ] æ”¯æ´ä»»å‹™åˆ†é¡èˆ‡ç‹€æ…‹æ¨™ç±¤
- [ ] åœ–è¡¨çµ±è¨ˆèˆ‡æ¯æ—¥åˆ†æå ±è¡¨
